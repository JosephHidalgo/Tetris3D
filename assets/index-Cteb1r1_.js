import{r as t}from"./howler-BBTmHrXV.js";import{C as e,V as n,M as i,T as s,Q as o,S as r,a,R as l,P as h,b as c,c as d,O as u,B as p,F as m,d as f,U as g,W as b,H as v,N as _,e as y,f as x,A as w,g as M,h as T,i as S,j as E,k as P,l as C,D,m as R,n as k,o as z,G as A,E as L,L as j,p as U,q as I,r as B,s as O,t as F,u as Y,v as Z,w as H,x as N,y as X,z as K}from"./three-Dv9WGmYB.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var W=t();const V={type:"change"},Q={type:"start"},G={type:"end"},q=new l,$=new h,J=Math.cos(70*c.DEG2RAD),tt=new n,et=2*Math.PI,nt=-1,it=0,st=1,ot=2,rt=3,at=4,lt=5,ht=6,ct=1e-6;class dt extends e{constructor(t,e=null){super(t,e),this.state=nt,this.target=new n,this.cursor=new n,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN},this.touches={ONE:s.ROTATE,TWO:s.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new n,this._lastQuaternion=new o,this._lastTargetPosition=new n,this._quat=(new o).setFromUnitVectors(t.up,new n(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new r,this._sphericalDelta=new r,this._scale=1,this._panOffset=new n,this._rotateStart=new a,this._rotateEnd=new a,this._rotateDelta=new a,this._panStart=new a,this._panEnd=new a,this._panDelta=new a,this._dollyStart=new a,this._dollyEnd=new a,this._dollyDelta=new a,this._dollyDirection=new n,this._mouse=new a,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=pt.bind(this),this._onPointerDown=ut.bind(this),this._onPointerUp=mt.bind(this),this._onContextMenu=xt.bind(this),this._onMouseWheel=bt.bind(this),this._onKeyDown=vt.bind(this),this._onTouchStart=_t.bind(this),this._onTouchMove=yt.bind(this),this._onMouseDown=ft.bind(this),this._onMouseMove=gt.bind(this),this._interceptControlDown=wt.bind(this),this._interceptControlUp=Mt.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(V),this.update(),this.state=nt}update(t=null){const e=this.object.position;tt.copy(e).sub(this.target),tt.applyQuaternion(this._quat),this._spherical.setFromVector3(tt),this.autoRotate&&this.state===nt&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(i)&&isFinite(s)&&(i<-Math.PI?i+=et:i>Math.PI&&(i-=et),s<-Math.PI?s+=et:s>Math.PI&&(s-=et),this._spherical.theta=i<=s?Math.max(i,Math.min(s,this._spherical.theta)):this._spherical.theta>(i+s)/2?Math.max(i,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=t!=this._spherical.radius}if(tt.setFromSpherical(this._spherical),tt.applyQuaternion(this._quatInverse),e.copy(this.target).add(tt),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=tt.length();t=this._clampDistance(e*this._scale);const n=e-t;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),o=!!n}else if(this.object.isOrthographicCamera){const e=new n(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=i!==this.object.zoom;const s=new n(this._mouse.x,this._mouse.y,0);s.unproject(this.object),this.object.position.sub(s).add(e),this.object.updateMatrixWorld(),t=tt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(q.origin.copy(this.object.position),q.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(q.direction))<J?this.object.lookAt(this.target):($.setFromNormalAndCoplanarPoint(this.object.up,this.target),q.intersectPlane($,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,!!(o||this._lastPosition.distanceToSquared(this.object.position)>ct||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ct||this._lastTargetPosition.distanceToSquared(this.target)>ct)&&(this.dispatchEvent(V),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?et/60*this.autoRotateSpeed*t:et/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){tt.setFromMatrixColumn(e,0),tt.multiplyScalar(-t),this._panOffset.add(tt)}_panUp(t,e){!0===this.screenSpacePanning?tt.setFromMatrixColumn(e,1):(tt.setFromMatrixColumn(e,0),tt.crossVectors(this.object.up,tt)),tt.multiplyScalar(t),this._panOffset.add(tt)}_pan(t,e){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;tt.copy(i).sub(this.target);let s=tt.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*s/n.clientHeight,this.object.matrix),this._panUp(2*e*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=t-n.left,s=e-n.top,o=n.width,r=n.height;this._mouse.x=i/o*2-1,this._mouse.y=-s/r*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(et*this._rotateDelta.x/e.clientHeight),this._rotateUp(et*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(et*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-et*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(et*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-et*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._panStart.set(n,i)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,i=t.pageY-e.y,s=Math.sqrt(n*n+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._rotateEnd.set(n,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(et*this._rotateDelta.x/e.clientHeight),this._rotateUp(et*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,i=t.pageY-e.y,s=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._updateZoomParameters(o,r)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new a,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function ut(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function pt(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function mt(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(G),this.state=nt;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y})}}function ft(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case i.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=st;break;case i.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=ot}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=it}break;case i.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=it}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=ot}break;default:this.state=nt}this.state!==nt&&this.dispatchEvent(Q)}function gt(t){switch(this.state){case it:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case st:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case ot:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function bt(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===nt&&(t.preventDefault(),this.dispatchEvent(Q),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(G))}function vt(t){!1!==this.enabled&&this._handleKeyDown(t)}function _t(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case s.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=rt;break;case s.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=at;break;default:this.state=nt}break;case 2:switch(this.touches.TWO){case s.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=lt;break;case s.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=ht;break;default:this.state=nt}break;default:this.state=nt}this.state!==nt&&this.dispatchEvent(Q)}function yt(t){switch(this._trackPointer(t),this.state){case rt:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case at:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case lt:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case ht:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=nt}}function xt(t){!1!==this.enabled&&t.preventDefault()}function wt(t){if("Control"===t.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function Mt(t){if("Control"===t.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const Tt={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class St{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Et=new u(-1,1,1,-1,0,1);const Pt=new class extends p{constructor(){super(),this.setAttribute("position",new m([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new m([0,2,0,0,2,0],2))}};class Ct{constructor(t){this._mesh=new d(Pt,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Et)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Dt extends St{constructor(t,e="tDiffuse"){super(),this.textureID=e,this.uniforms=null,this.material=null,t instanceof f?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=g.clone(t.uniforms),this.material=new f({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this._fsQuad=new Ct(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this._fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this._fsQuad.render(t))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Rt extends St{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const i=t.getContext(),s=t.state;let o,r;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,r=1):(o=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class kt extends St{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}const zt={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new x(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class At extends St{constructor(t,e=1,i,s){super(),this.strength=e,this.radius=i,this.threshold=s,this.resolution=void 0!==t?new a(t.x,t.y):new a(256,256),this.clearColor=new x(0,0,0),this.needsSwap=!1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let o=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new b(o,r,{type:v}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let n=0;n<this.nMips;n++){const t=new b(o,r,{type:v});t.texture.name="UnrealBloomPass.h"+n,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);const e=new b(o,r,{type:v});e.texture.name="UnrealBloomPass.v"+n,e.texture.generateMipmaps=!1,this.renderTargetsVertical.push(e),o=Math.round(o/2),r=Math.round(r/2)}const l=zt;this.highPassUniforms=g.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new f({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),this.separableBlurMaterials=[];const h=[3,5,7,9,11];o=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let n=0;n<this.nMips;n++)this.separableBlurMaterials.push(this._getSeparableBlurMaterial(h[n])),this.separableBlurMaterials[n].uniforms.invSize.value=new a(1/o,1/r),o=Math.round(o/2),r=Math.round(r/2);this.compositeMaterial=this._getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new n(1,1,1),new n(1,1,1),new n(1,1,1),new n(1,1,1),new n(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=g.clone(Tt.uniforms),this.blendMaterial=new f({uniforms:this.copyUniforms,vertexShader:Tt.vertexShader,fragmentShader:Tt.fragmentShader,blending:w,depthTest:!1,depthWrite:!1,transparent:!0}),this._oldClearColor=new x,this._oldClearAlpha=1,this._basic=new M,this._fsQuad=new Ct(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this._basic.dispose(),this._fsQuad.dispose()}setSize(t,e){let n=Math.round(t/2),i=Math.round(e/2);this.renderTargetBright.setSize(n,i);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(n,i),this.renderTargetsVertical[s].setSize(n,i),this.separableBlurMaterials[s].uniforms.invSize.value=new a(1/n,1/i),n=Math.round(n/2),i=Math.round(i/2)}render(t,e,n,i,s){t.getClearColor(this._oldClearColor),this._oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),s&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this._fsQuad.material=this._basic,this._basic.map=n.texture,t.setRenderTarget(null),t.clear(),this._fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this._fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this._fsQuad.render(t);let r=this.renderTargetBright;for(let a=0;a<this.nMips;a++)this._fsQuad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=r.texture,this.separableBlurMaterials[a].uniforms.direction.value=At.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[a]),t.clear(),this._fsQuad.render(t),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=At.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[a]),t.clear(),this._fsQuad.render(t),r=this.renderTargetsVertical[a];this._fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this._fsQuad.render(t),this._fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this._fsQuad.render(t)):(t.setRenderTarget(n),this._fsQuad.render(t)),t.setClearColor(this._oldClearColor,this._oldClearAlpha),t.autoClear=o}_getSeparableBlurMaterial(t){const e=[];for(let n=0;n<t;n++)e.push(.39894*Math.exp(-.5*n*n/(t*t))/t);return new f({defines:{KERNEL_RADIUS:t},uniforms:{colorTexture:{value:null},invSize:{value:new a(.5,.5)},direction:{value:new a(.5,.5)},gaussianCoefficients:{value:e}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}_getCompositeMaterial(t){return new f({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}function Lt(t){const e=document.getElementById("hud-info"),n=document.getElementById("controles-3d");e&&"juego"===t?(e.innerHTML="\n            <b>Tetris 3D</b><br>\n            <span style='color:#aaa;font-size:0.95em;'>Proyecto de Computación Gráfica<br>Verdadero Tetris en espacio 3D</span>\n        ",e.style.display="block",n&&(n.style.display="block")):(e&&(e.style.display="none"),n&&(n.style.display="none"))}function jt(t,e,n){const i=document.getElementById("hud");i&&(i.innerHTML=`\n            <b>Puntaje:</b> ${t}<br>\n            <b>Nivel:</b> ${e}<br>\n            <b>Posición:</b><br>\n            X: ${n?n.x:0}<br>\n            Y: ${n?n.y:0}<br>\n            Z: ${n?n.z:0}\n        `)}function Ut(t,e){const n=[[0,8,-6,0],[6,12,-2,1],[-6,10,4,2],[0,6,6,3],[-8,14,2,4],[8,13,-4,5],[4,16,4,6],[-4,5,-8,7]];for(let r=0;r<n.length;r++){const[i,s,o,a]=n[r],l=e(a,0,0,0);l.position.set(i,s,o),l.rotation.y=Math.random()*Math.PI*2,l.rotation.x=Math.random()*Math.PI*2,l.rotation.z=Math.random()*Math.PI*2,l.name="decorativo",t.add(l)}const i=new k(3,3,3),s=new z({color:16777215,metalness:.8,roughness:.1,emissive:49151}),o=new d(i,s);o.name="logoCuboDecorativo",o.position.set(0,8,0),o.castShadow=!0,t.add(o)}At.BlurDirectionX=new a(1,0),At.BlurDirectionY=new a(0,1);const It=[[[0,0,0],[0,1,0],[0,2,0],[0,3,0]],[[0,0,0],[1,0,0],[0,1,0],[1,1,0]],[[0,0,0],[-1,1,0],[0,1,0],[1,1,0]],[[0,0,0],[0,1,0],[0,2,0],[1,2,0]],[[0,0,0],[0,1,0],[0,2,0],[-1,2,0]],[[0,0,0],[1,0,0],[0,1,0],[-1,1,0]],[[0,0,0],[-1,0,0],[0,1,0],[1,1,0]],[[0,0,0],[1,0,0],[-1,0,0],[0,0,1],[0,0,-1]],[[0,0,0],[0,1,0],[0,2,0],[0,0,1]],[[0,0,0],[1,0,0],[1,1,0],[1,1,1]]],Bt=[57599,16776960,11141375,65280,16711680,255,16753920,16738740,3329330,16729344],Ot=[35071,8947712,6684808,34816,8912896,136,11162880,8930423,2263108,8921600];function Ft(t,e,n,i){let s=t.map(([t,e,n])=>[t,e,n]);for(let o=0;o<e;o++)s=s.map(([t,e,n])=>[t,-n,e]);for(let o=0;o<n;o++)s=s.map(([t,e,n])=>[n,e,-t]);for(let o=0;o<i;o++)s=s.map(([t,e,n])=>[e,-t,n]);return s}function Yt(t,e,n,i){const s=new A,o=new z({color:Bt[t],emissive:Ot[t],emissiveIntensity:.3,metalness:.7,roughness:.2}),r=Ft(It[t],e,n,i);for(let a=0;a<r.length;a++){const[t,e,n]=r[a],i=new d(new k(.9,.9,.9),o);i.position.set(t,e,n),i.castShadow=!0,i.receiveShadow=!0,s.add(i);const l=new L(new k(.9,.9,.9)),h=new j(l,new U({color:16777215}));h.position.copy(i.position),s.add(h)}return s}const Zt=16;let Ht;function Nt(t,e,n,i,s){const o=Ft(It[t],n,i,s);for(let r=0;r<o.length;r++){const[t,n,i]=o[r],s=e.x+t,a=e.y+n,l=e.z+i;if(s<0||s>=8||a<0||a>=Zt||l<0||l>=8)return!0;if(Ht[a][s][l])return!0}return!1}const Xt=new W.Howl({src:["https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e2.mp3"],volume:.3}),Kt=new W.Howl({src:["https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e2.mp3"],rate:.7,volume:.2}),Wt=new W.Howl({src:["https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e2.mp3"],rate:.4,volume:.4});function Vt(t,e){const n=document.getElementById("main-menu");n&&(n.style.display="flex");const i=document.getElementById("btn-jugar");i&&(i.onclick=()=>{n.style.display="none",e()})}function Qt(){const t=document.getElementById("gameOverContainer");t&&(t.handleKeyPress&&document.removeEventListener("keydown",t.handleKeyPress),t.remove())}class Gt{constructor(t,e){this.scene=t,this.renderer=e,this.particles=[],this.lights=[],this.setupRenderer(),this.createBackground(),this.createLighting(),this.createFog(),this.createFloor()}setupRenderer(){this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=C,this.renderer.toneMapping=I,this.renderer.toneMappingExposure=1.2,this.renderer.setClearColor(0,1)}createBackground(){const t=new B(2,2);this.backgroundMaterial=new f({uniforms:{time:{value:0}},vertexShader:"\n            varying vec2 vUv;\n            varying vec3 vPosition;\n            void main() {\n                vUv = uv;\n                vPosition = position;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n        ",fragmentShader:"\n            varying vec2 vUv;\n            varying vec3 vPosition;\n            uniform float time;\n            \n            void main() {\n                vec2 center = vec2(0.5, 0.7);\n                float dist = distance(vUv, center);\n                \n                vec3 colorTop = vec3(0.0, 0.0, 0.0);\n                vec3 colorMid = vec3(0.02, 0.02, 0.08);\n                vec3 colorBottom = vec3(0.05, 0.02, 0.12);\n                \n                float factor1 = smoothstep(0.0, 0.3, vUv.y);\n                float factor2 = smoothstep(0.3, 1.0, vUv.y);\n                \n                vec3 color = mix(colorTop, colorMid, factor1);\n                color = mix(color, colorBottom, factor2);\n                \n                gl_FragColor = vec4(color, 1.0);\n            }\n        ",depthWrite:!1,depthTest:!1});const e=new d(t,this.backgroundMaterial);e.renderOrder=-1,this.backgroundScene=new T,this.backgroundCamera=new O,this.backgroundScene.add(e),this.backgroundScene.add(this.backgroundCamera)}createLighting(){const t=new R(656672,.3);this.scene.add(t);const e=new D(4858026,.4);e.position.set(10,15,10),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=100,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.bias=-1e-4,this.scene.add(e),this.lights.push(e);const n=new D(43775,.2);n.position.set(-10,8,-10),this.scene.add(n),this.lights.push(n);const i=new D(10181046,.2);i.position.set(5,5,-15),this.scene.add(i),this.lights.push(i);const s=new D(3816028,.15);s.position.set(0,-5,5),this.scene.add(s),this.lights.push(s)}createFog(){this.scene.fog=new F(0,30,120)}createFloor(){const t=new Y(28,64),e=new f({uniforms:{time:{value:0},centerColor:{value:new x(1707822)},edgeColor:{value:new x(0)}},vertexShader:"\n                varying vec2 vUv;\n                varying vec3 vWorldPosition;\n                void main() {\n                    vUv = uv;\n                    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n                    vWorldPosition = worldPosition.xyz;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            ",fragmentShader:"\n                uniform float time;\n                uniform vec3 centerColor;\n                uniform vec3 edgeColor;\n                varying vec2 vUv;\n                varying vec3 vWorldPosition;\n                \n                void main() {\n                    vec2 center = vec2(0.5);\n                    float dist = distance(vUv, center);\n                    \n                    vec3 centerColor = vec3(0.8, 0.2, 1.0);\n                    vec3 midColor = vec3(0.4, 0.6, 1.0);\n                    vec3 edgeColor = vec3(0.0, 0.8, 1.0);\n                    \n                    float factor1 = smoothstep(0.0, 0.6, dist);\n                    float factor2 = smoothstep(0.6, 0.8, dist);\n                    \n                    vec3 color = mix(centerColor, midColor, factor1);\n                    color = mix(color, edgeColor, factor2);\n                    \n                    float fadeOut = exp(-dist * 4.0);;\n                    color *= fadeOut;\n                    \n                    float pulse = sin(time * 0.003) * 0.1 + 0.9;\n                    color *= pulse;\n                    \n                    gl_FragColor = vec4(color, fadeOut * 0.9);\n                }\n            ",transparent:!0,side:Z}),n=new d(t,e);n.rotation.x=-Math.PI/2,n.position.y=-1,n.receiveShadow=!0,this.scene.add(n),this.floorMaterial=e}createParticles(){const t=new p,e=150,n=new Float32Array(450),i=new Float32Array(450),s=new Float32Array(e);for(let r=0;r<e;r++){n[3*r]=120*(Math.random()-.5),n[3*r+1]=60*Math.random()+5,n[3*r+2]=120*(Math.random()-.5);const t=Math.random();let e;e=new x(t<.4?6966419:t<.7?4886754:10181046),i[3*r]=e.r,i[3*r+1]=e.g,i[3*r+2]=e.b,s[r]=.3*Math.random()+.1}t.setAttribute("position",new H(n,3)),t.setAttribute("color",new H(i,3)),t.setAttribute("size",new H(s,1));const o=new N({size:.2,transparent:!0,opacity:.4,vertexColors:!0,blending:w,sizeAttenuation:!0});this.particleSystem=new X(t,o),this.scene.add(this.particleSystem)}animateParticles(t){if(this.particleSystem){const e=this.particleSystem.geometry.attributes.position.array;for(let n=0;n<e.length;n+=3)e[n+1]+=.02*Math.sin(5e-4*t+.01*e[n]),e[n]+=.01*Math.cos(3e-4*t+.01*e[n+2]),e[n+1]>65&&(e[n+1]=5);this.particleSystem.geometry.attributes.position.needsUpdate=!0,this.particleSystem.rotation.y=5e-5*t}}renderBackground(){this.renderer.setClearColor(0,1),this.renderer.clear(!0,!1,!1),this.renderer.render(this.backgroundScene,this.backgroundCamera)}animateLights(t){this.lights.forEach((e,n)=>{if("DirectionalLight"===e.type&&n>0){const i=[.3,.2,.15][n-1]||.1;e.intensity=i+.05*Math.sin(.001*t+2*n)}})}update(t){this.animateLights(t),this.backgroundMaterial&&(this.backgroundMaterial.uniforms.time.value=t),this.floorMaterial&&(this.floorMaterial.uniforms.time.value=t)}setAmbientIntensity(t){this.lights.forEach(e=>{e.intensity*=t}),this.particleSystem&&(this.particleSystem.material.opacity=.4*t)}}let qt,$t,Jt,te,ee,ne,ie,se,oe,re,ae,le="menu",he=0,ce=800,de=0,ue=1,pe=0,me=0,fe=0;function ge(){le="juego",Qt();const t=[];qt.traverse(e=>{"decorativo"!==e.name&&"logoCuboDecorativo"!==e.name&&"cuboFijo"!==e.name||t.push(e)}),t.forEach(t=>qt.remove(t)),function(){Ht=[];for(let t=0;t<Zt;t++){Ht[t]=[];for(let e=0;e<8;e++){Ht[t][e]=[];for(let n=0;n<8;n++)Ht[t][e][n]=0}}}(),se&&qt.remove(se),se=function(){const t=new A,e=new U({color:8947848,transparent:!0,opacity:.3}),i=[[-4,0,-4],[4,0,-4],[4,0,-4],[4,0,4],[4,0,4],[-4,0,4],[-4,0,4],[-4,0,-4],[-4,Zt,-4],[4,Zt,-4],[4,Zt,-4],[4,Zt,4],[4,Zt,4],[-4,Zt,4],[-4,Zt,4],[-4,Zt,-4],[-4,0,-4],[-4,Zt,-4],[4,0,-4],[4,Zt,-4],[4,0,4],[4,Zt,4],[-4,0,4],[-4,Zt,4]];for(let a=0;a<i.length;a+=2){const s=(new p).setFromPoints([new n(...i[a]),new n(...i[a+1])]),o=new K(s,e);t.add(o)}const s=new B(8,8),o=new z({visible:!1}),r=new d(s,o);return r.rotation.x=-Math.PI/2,r.position.y=0,t.add(r),t}(),qt.add(se),de=0,ue=1,ce=800,pe=0,me=0,fe=0,jt(de,ue,ae),be(),document.addEventListener("keydown",_e),he=performance.now(),Lt(le)}function be(){oe&&qt.remove(oe),re=Math.floor(Math.random()*It.length),pe=0,me=0,fe=0;const t=It[re];let e=Math.max(...t.map(([t,e,n])=>e));ae={x:Math.floor(4),y:15-e,z:Math.floor(4)},oe=Yt(re,pe,me,fe),ve(),qt.add(oe)}function ve(){oe&&oe.position.set(ae.x-4+.5,ae.y,ae.z-4+.5)}function _e(t){const e=function(t,e,n,i,s,o,r,a,l,h){if("juego"!==e)return{piezaPos:n,rotacionX:i,rotacionY:s,rotacionZ:o};let c={...n},d=i,u=s,p=o;switch(t.key){case"ArrowLeft":c.x--;break;case"ArrowRight":c.x++;break;case"ArrowUp":c.z--;break;case"ArrowDown":c.z++;break;case"q":case"Q":c.y++;break;case"e":case"E":c.y--;break;case"w":case"W":d=(i+1)%4;break;case"s":case"S":d=(i+3)%4;break;case"a":case"A":u=(s+1)%4;break;case"d":case"D":u=(s+3)%4;break;case"z":case"Z":p=(o+1)%4;break;case"c":case"C":p=(o+3)%4;break;case" ":for(;!a({x:n.x,y:n.y-1,z:n.z});)n.y--;return l(n,i,s,o),{piezaPos:n,rotacionX:i,rotacionY:s,rotacionZ:o}}return a(c,d,u,p)||(l(n=c,i=d,s=u,o=p),h()),{piezaPos:n,rotacionX:i,rotacionY:s,rotacionZ:o}}(t,le,ae,pe,me,fe,0,(t,e,n,i)=>Nt(re,t||ae,e??pe,n??me,i??fe),(t,e,n,i)=>{ae=t,pe=e,me=n,fe=i,qt.remove(oe),oe=Yt(re,pe,me,fe),ve(),qt.add(oe)},()=>jt(de,ue,ae));ae=e.piezaPos,pe=e.rotacionX,me=e.rotacionY,fe=e.rotacionZ}window.addEventListener("resize",()=>{$t.aspect=window.innerWidth/window.innerHeight,$t.updateProjectionMatrix(),Jt.setSize(window.innerWidth,window.innerHeight),ee.setSize(window.innerWidth,window.innerHeight)}),({scene:qt,camera:$t,renderer:Jt,controls:te}=function(){const t=new T,e=document.createElement("canvas");e.width=1,e.height=256;const n=e.getContext("2d"),i=n.createLinearGradient(0,0,0,256);i.addColorStop(0,"#000000"),i.addColorStop(1,"#000000"),n.fillStyle=i,n.fillRect(0,0,1,256);const s=new S(e);t.background=s;const o=new E(60,window.innerWidth/window.innerHeight,.1,100);o.position.set(15,15,15),o.lookAt(0,6,0);const r=new P({antialias:!0});r.setSize(window.innerWidth,window.innerHeight),r.shadowMap.enabled=!0,r.shadowMap.type=C,document.body.appendChild(r.domElement);const a=new dt(o,r.domElement);a.target.set(0,6,0),a.enableDamping=!0,a.dampingFactor=.08,a.minDistance=10,a.maxDistance=40;const l=new D(16777215,.8);l.position.set(10,15,10),l.castShadow=!0,l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048,t.add(l);const h=new D(16777215,.6);h.position.set(-10,15,-10),t.add(h);const c=new D(16777215,.4);return c.position.set(0,15,-15),t.add(c),t.add(new R(4210784,.8)),function(){let t=document.getElementById("hud");t||(t=document.createElement("div"),t.id="hud",t.style.position="absolute",t.style.top="10px",t.style.right="20px",t.style.color="#fff",t.style.fontFamily="Arial",t.style.fontSize="1.2em",t.style.zIndex="2",t.style.background="rgba(0,0,0,0.3)",t.style.padding="10px",t.style.borderRadius="8px",document.body.appendChild(t));let e=document.getElementById("controles-3d");e||(e=document.createElement("div"),e.id="controles-3d",e.style.position="absolute",e.style.top="10px",e.style.left="20px",e.style.color="#00e0ff",e.style.fontFamily="Arial",e.style.fontSize="0.9em",e.style.zIndex="2",e.style.background="rgba(0,0,0,0.3)",e.style.padding="10px",e.style.borderRadius="8px",e.innerHTML="\n            <b>Controles 3D:</b><br>\n            ↑↓←→: Mover X,Z<br>\n            Q/E: Mover Y<br>\n            W/S: Rotar X<br>\n            A/D: Rotar Y<br>\n            Z/C: Rotar Z<br>\n            Espacio: Caída rápida\n        ",document.body.appendChild(e));let n=document.getElementById("hud-info");n||(n=document.createElement("div"),n.id="hud-info",n.style.position="absolute",n.style.left="20px",n.style.bottom="18px",n.style.color="#00e0ff",n.style.fontFamily="Arial",n.style.fontSize="1.05em",n.style.zIndex="2",n.style.background="rgba(0,0,0,0.25)",n.style.padding="8px 16px",n.style.borderRadius="10px",n.style.pointerEvents="none",document.body.appendChild(n))}(),{scene:t,camera:o,renderer:r,controls:a}}()),ee=new class{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===e){const n=t.getSize(new a);this._width=n.width,this._height=n.height,(e=new b(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:v})).texture.name="EffectComposer.rt1"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Dt(Tt),this.copyPass.material.blending=_,this.clock=new y}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let i=0,s=this.passes.length;i<s;i++){const e=this.passes[i];if(!1!==e.enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),e.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Rt&&(e instanceof Rt?n=!0:e instanceof kt&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new a);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}(Jt),ee.addPass(new class extends St{constructor(t,e,n=null,i=null,s=null){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new x}render(t,e,n){const i=t.autoClear;let s,o;t.autoClear=!1,null!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(t.getClearColor(this._oldClearColor),t.setClearColor(this.clearColor,t.getClearAlpha())),null!==this.clearAlpha&&(s=t.getClearAlpha(),t.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),null!==this.clearColor&&t.setClearColor(this._oldClearColor),null!==this.clearAlpha&&t.setClearAlpha(s),null!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=i}}(qt,$t)),ee.addPass(new At(new a(window.innerWidth,window.innerHeight),.8,.6,.9));const ye=function(t,e){const n=new Gt(t,e);return{ambience:n,customRender:function(t,i){n.renderBackground(),e.render(t,i)},update:t=>n.update(t)}}(qt,Jt);ne=ye.customRender,ie=ye.update,Ut(qt,Yt),function(){let t=document.getElementById("main-menu");if(!t){t=document.createElement("div"),t.id="main-menu",t.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.7);\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            z-index: 10;\n            font-family: Arial, sans-serif;\n            color: white;\n        ",t.innerHTML='\n            <h1 style="font-size: 4em; margin: 0; color: #00e0ff; text-shadow: 0 0 20px #00e0ff;">\n                TETRIS 3D\n            </h1>\n            <p style="font-size: 1.5em; margin: 20px 0; text-align: center; color: #aaa;">\n                ¡Experimenta Tetris en verdadero espacio tridimensional!\n            </p>\n            <button id="btn-jugar" style="\n                font-size: 1.5em;\n                padding: 15px 30px;\n                background: linear-gradient(45deg, #00e0ff, #0080ff);\n                color: white;\n                border: none;\n                border-radius: 10px;\n                cursor: pointer;\n                margin: 10px;\n                box-shadow: 0 4px 15px rgba(0,224,255,0.3);\n                transition: all 0.3s ease;\n            ">\n                🎮 JUGAR\n            </button>\n            <div style="margin-top: 30px; text-align: center; color: #888; font-size: 0.9em;">\n                <p><strong>Controles 3D:</strong></p>\n                <p>↑↓←→: Mover en plano XZ | Q/E: Subir/Bajar | W/S: Rotar X</p>\n                <p>A/D: Rotar Y | Z/C: Rotar Z | Espacio: Caída rápida</p>\n            </div>\n        ',document.body.appendChild(t);const e=document.getElementById("btn-jugar");e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.05)",e.style.boxShadow="0 6px 20px rgba(0,224,255,0.5)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 15px rgba(0,224,255,0.3)"})}let e=document.getElementById("gameover-panel");e||(e=document.createElement("div"),e.id="gameover-panel",e.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(255,0,0,0.1);\n            display: none;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            z-index: 15;\n            font-family: Arial, sans-serif;\n            color: white;\n        ",e.innerHTML='\n            <h1 style="font-size: 3em; margin: 0; color: #ff4444; text-shadow: 0 0 20px #ff4444;">\n                GAME OVER\n            </h1>\n            <div id="puntaje-final" style="font-size: 1.5em; margin: 20px 0; text-align: center;"></div>\n            <button id="btn-reiniciar" style="\n                font-size: 1.3em;\n                padding: 12px 25px;\n                background: linear-gradient(45deg, #ff4444, #ff6666);\n                color: white;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                margin: 10px;\n                box-shadow: 0 4px 15px rgba(255,68,68,0.3);\n                transition: all 0.3s ease;\n            ">\n                🔄 REINTENTAR\n            </button>\n            <button id="btn-menu" style="\n                font-size: 1.1em;\n                padding: 10px 20px;\n                background: rgba(255,255,255,0.1);\n                color: white;\n                border: 1px solid rgba(255,255,255,0.3);\n                border-radius: 6px;\n                cursor: pointer;\n                margin: 5px;\n                transition: all 0.3s ease;\n            ">\n                📋 MENÚ PRINCIPAL\n            </button>\n        ',document.body.appendChild(e))}(),Vt(0,ge),function t(e){if(requestAnimationFrame(t),ie&&ie(e),"menu"===le&&qt.traverse(t=>{"decorativo"===t.name?(t.rotation.x+=.01,t.rotation.y+=.015,t.rotation.z+=.008):"logoCuboDecorativo"===t.name&&(t.rotation.y+=.02,t.rotation.x+=.01)}),"juego"===le){const t=performance.now();if(t-he>ce){let e={x:ae.x,y:ae.y-1,z:ae.z};if(Nt(re,e,pe,me,fe)){if(Nt(re,ae,pe,me,fe))return le="gameover",document.removeEventListener("keydown",_e),Wt.play(),void function(t,e,n,i){Qt();const s=document.createElement("div");s.id="gameOverContainer",s.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: linear-gradient(45deg, rgba(0, 0, 0, 0.95), rgba(10, 0, 20, 0.95));\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 1000;\n        font-family: 'Courier New', monospace;\n        backdrop-filter: blur(8px);\n        overflow: hidden;\n    ";const o=document.createElement("div");o.style.cssText="\n        background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(20, 0, 40, 0.9));\n        border: 2px solid #ff0080;\n        border-radius: 0;\n        padding: 50px;\n        text-align: center;\n        box-shadow: \n            0 0 100px rgba(255, 0, 128, 0.5),\n            inset 0 0 50px rgba(0, 255, 255, 0.1);\n        max-width: 600px;\n        width: 90%;\n        position: relative;\n        animation: cyberpunkGlitch 0.8s ease-out;\n        clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 20px 100%, 0 calc(100% - 20px));\n    ";const r=document.createElement("style");r.textContent="\n        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');\n        \n        @keyframes cyberpunkGlitch {\n            0% {\n                transform: translateX(-100vw) rotateY(90deg);\n                filter: hue-rotate(0deg);\n            }\n            20% {\n                transform: translateX(0) rotateY(0deg);\n                filter: hue-rotate(180deg);\n            }\n            30% {\n                transform: translateX(-10px);\n                filter: hue-rotate(0deg);\n            }\n            40% {\n                transform: translateX(10px);\n                filter: hue-rotate(90deg);\n            }\n            50% {\n                transform: translateX(0);\n                filter: hue-rotate(0deg);\n            }\n            100% {\n                transform: translateX(0) rotateY(0deg);\n                filter: hue-rotate(0deg);\n            }\n        }\n        \n        @keyframes neonPulse {\n            0%, 100% { \n                text-shadow: \n                    0 0 5px #ff0080,\n                    0 0 10px #ff0080,\n                    0 0 15px #ff0080,\n                    0 0 20px #ff0080;\n            }\n            50% { \n                text-shadow: \n                    0 0 10px #ff0080,\n                    0 0 20px #ff0080,\n                    0 0 30px #ff0080,\n                    0 0 40px #ff0080;\n            }\n        }\n        \n        @keyframes dataStream {\n            0% { opacity: 0; transform: translateY(-20px); }\n            100% { opacity: 1; transform: translateY(0); }\n        }\n        \n        .cyberpunk-title {\n            font-family: 'Orbitron', monospace;\n            font-weight: 900;\n            letter-spacing: 8px;\n            animation: neonPulse 2s infinite;\n        }\n        \n        .cyber-button {\n            background: linear-gradient(45deg, transparent, rgba(255, 0, 128, 0.2), transparent);\n            border: 2px solid #00ffff;\n            color: #00ffff;\n            padding: 18px 35px;\n            margin: 15px;\n            font-family: 'Orbitron', monospace;\n            font-size: 16px;\n            font-weight: 700;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            position: relative;\n            overflow: hidden;\n            clip-path: polygon(10px 0, 100% 0, calc(100% - 10px) 100%, 0 100%);\n        }\n        \n        .cyber-button::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.4), transparent);\n            transition: left 0.5s;\n        }\n        \n        .cyber-button:hover::before {\n            left: 100%;\n        }\n        \n        .cyber-button:hover {\n            transform: translateY(-2px);\n            box-shadow: \n                0 10px 30px rgba(0, 255, 255, 0.3),\n                0 0 20px rgba(255, 0, 128, 0.5);\n            border-color: #ff0080;\n            color: #ff0080;\n        }\n        \n        .cyber-button:active {\n            transform: translateY(0);\n        }\n        \n        .data-panel {\n            background: linear-gradient(135deg, rgba(0, 255, 255, 0.05), rgba(255, 0, 128, 0.05));\n            border: 1px solid rgba(0, 255, 255, 0.3);\n            padding: 25px;\n            margin: 25px 0;\n            position: relative;\n            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));\n            animation: dataStream 0.8s ease-out 0.3s both;\n        }\n        \n        .data-panel::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background: linear-gradient(90deg, transparent, #00ffff, transparent);\n            animation: scanLine 2s infinite;\n        }\n        \n        @keyframes scanLine {\n            0%, 100% { transform: translateX(-100%); }\n            50% { transform: translateX(100%); }\n        }\n        \n        .stat-value {\n            font-family: 'Orbitron', monospace;\n            font-weight: 700;\n            font-size: 24px;\n            text-shadow: 0 0 10px currentColor;\n        }\n        \n        .glitch-text {\n            position: relative;\n            display: inline-block;\n        }\n        \n        .glitch-text::before {\n            content: attr(data-text);\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            color: #ff0080;\n            opacity: 0.8;\n            clip: rect(0, 900px, 0, 0);\n            animation: glitch1 0.1s infinite linear alternate-reverse;\n        }\n        \n        @keyframes glitch1 {\n            0% { clip: rect(42px, 9999px, 44px, 0); }\n            100% { clip: rect(12px, 9999px, 59px, 0); }\n        }\n    ",document.head.appendChild(r),o.innerHTML=`\n        <div style="position: absolute; top: 10px; left: 10px; color: #00ffff; font-size: 12px; opacity: 0.7;">\n            SYSTEM_ERROR_404\n        </div>\n        \n        <h1 class="cyberpunk-title glitch-text" data-text="TERMINAL FAILURE" style="\n            color: #ff0080; \n            font-size: 42px; \n            margin: 0 0 30px 0;\n        ">\n            TERMINAL FAILURE\n        </h1>\n        \n        <div class="data-panel">\n            <h2 style="color: #00ffff; margin: 0 0 20px 0; font-size: 18px; font-family: 'Orbitron', monospace; letter-spacing: 3px;">\n                [[ FINAL DATA DUMP ]]\n            </h2>\n            <div style="display: flex; justify-content: space-between; align-items: center;">\n                <div>\n                    <div style="color: #888; font-size: 14px; margin-bottom: 5px;">SCORE_VALUE:</div>\n                    <div class="stat-value" style="color: #00ff41;">${t.toLocaleString()}</div>\n                </div>\n                <div style="color: #ff0080; font-size: 20px;">|</div>\n                <div>\n                    <div style="color: #888; font-size: 14px; margin-bottom: 5px;">LEVEL_REACHED:</div>\n                    <div class="stat-value" style="color: #ffff00;">${e}</div>\n                </div>\n            </div>\n        </div>\n        \n        <div style="margin-top: 35px;">\n            <button id="btnReiniciar" class="cyber-button">\n                RESTART_SYSTEM\n            </button>\n            <button id="btnVolverMenu" class="cyber-button">\n                EXIT_TO_MAIN\n            </button>\n        </div>\n        \n        <div style="margin-top: 25px; padding: 15px; border-top: 1px solid rgba(0, 255, 255, 0.2);">\n            <p style="color: #666; font-size: 12px; font-family: 'Courier New', monospace; letter-spacing: 1px;">\n                [SPACE] RESTART_PROTOCOL // [ESC] RETURN_TO_MAINFRAME\n            </p>\n        </div>\n        \n        <div style="position: absolute; bottom: 10px; right: 15px; color: #ff0080; font-size: 10px; opacity: 0.6;">\n            TETRIS_v3.7.2_BETA\n        </div>\n    `,s.appendChild(o),document.body.appendChild(s),document.getElementById("btnReiniciar").addEventListener("click",()=>{Qt(),n()}),document.getElementById("btnVolverMenu").addEventListener("click",()=>{Qt(),i()});const a=t=>{"Space"===t.code?(t.preventDefault(),Qt(),n(),document.removeEventListener("keydown",a)):"Escape"===t.code&&(t.preventDefault(),Qt(),i(),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a),s.handleKeyPress=a}(de,ue,()=>{ge()},()=>{le="menu",se&&qt.remove(se),oe&&qt.remove(oe);const t=[];qt.traverse(e=>{"cuboFijo"===e.name&&t.push(e)}),t.forEach(t=>qt.remove(t)),Ut(qt,Yt),Vt(0,ge)});!function(t,e,n,i,s){const o=Ft(It[t],n,i,s);for(let r=0;r<o.length;r++){const[n,i,s]=o[r],a=e.x+n,l=e.y+i,h=e.z+s;a>=0&&a<8&&l>=0&&l<Zt&&h>=0&&h<8&&(Ht[l][a][h]=t+1)}}(re,ae,pe,me,fe);let t=It[re].map(([t,e,n])=>[t,e,n]);for(let n=0;n<pe;n++)t=t.map(([t,e,n])=>[t,-n,e]);for(let n=0;n<me;n++)t=t.map(([t,e,n])=>[n,e,-t]);for(let n=0;n<fe;n++)t=t.map(([t,e,n])=>[e,-t,n]);for(let n=0;n<t.length;n++){const[e,i,s]=t[n],o=ae.x+e,r=ae.y+i,a=ae.z+s;if(o>=0&&o<8&&r>=0&&r<Zt&&a>=0&&a<8){const t=new z({color:Bt[re],emissive:Ot[re],emissiveIntensity:.3,metalness:.7,roughness:.2}),e=new d(new k(.9,.9,.9),t);e.position.set(o-4+.5,r,a-4+.5),e.castShadow=!0,e.receiveShadow=!0,e.name="cuboFijo",qt.add(e);const n=new L(new k(.9,.9,.9)),i=new j(n,new U({color:16777215}));i.position.copy(e.position),i.name="cuboFijo",qt.add(i)}}Kt.play();const e=function(t,e,n,i,s){let o=0;for(let r=0;r<Zt;r++){let t=!0;for(let e=0;e<8&&t;e++)for(let n=0;n<8&&t;n++)Ht[r][e][n]||(t=!1);if(t){o++;for(let t=r;t<15;t++)for(let e=0;e<8;e++)for(let n=0;n<8;n++)Ht[t][e][n]=Ht[t+1][e][n];for(let t=0;t<8;t++)for(let e=0;e<8;e++)Ht[15][t][e]=0;r--}}return o>0&&(e.play(),(n+=200*o*i)>=1e3*i&&i++,s()),{puntaje:n,nivel:i}}(0,Xt,de,ue,()=>jt(de,ue,ae));de=e.puntaje,ue=e.nivel,jt(de,ue,ae),be()}else ae=e,ve(),jt(de,ue,ae);he=t}}te&&te.update(),ne?ne(qt,$t):ee.render(),Lt(le)}();
